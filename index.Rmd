---
title: "Diagnóstico del glaucoma "
date: "`r Sys.Date()`"
---

```{r knitr-init, echo=F}
library(knitr)
library(rmarkdown)
## Global options
options(digits = 4)
opts_chunk$set(echo=F, cache=T, prompt=F, tidy=T, comment=NA, message=F, warning=F, dev="png", dev.args=list(type="cairo"), dpi=300)
```

```{r carga-paquetes, results='hide'}
# Carga de paquetes
.packages <- c("tidyverse", "DT", "kableExtra", "psych", "GGally")
.installed <- .packages %in% installed.packages()
if (length(.packages[!.installed])>0) install.packages(.packages[!.installed])
lapply(.packages, library, character.only=T)
```

```{r carga-datos}
# Carga de datos
#datos <- read.csv(file="data/datos.csv", header=T, sep=",")
load("data/data-preprocesed.RData")
```

# Autores

- Alfonso Parra Blesa (alfonsoparrablesa@gmail.com)
- Alfredo Sánchez Alberca (asalber@ceu.es)

# Objetivo

Construir un modelo predictivo del glaucoma a partir de los datos de la tomografía de coherencia óptica mediante técnicas de aprendizaje automático.


# Tipo de estudio

Estudio analítico observacional transversal comparativo. 


# Tamaño muestral

Número total de ojos: `r nrow(df)`

# Variables

```{r variables}
variables <- read.csv(file="data/variables.csv", encoding="UTF-8", header=T, sep=",")
datatable(variables, rownames = F, escape=F, class = 'display', options = list(pageLength = 10, dom="ltip", language = list(url = 'http://cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json')))
variables.Num <- variables[variables$Type=="Num",]
variables.Factors <- variables[variables$Type=="Factor",]
```

# Resumen descriptivo de las variables generales 

## Distribución por Glaucoma

```{r tamaño-muestral}
result <- count(df, Glaucoma)
result %>% 
  kable(caption = "Distribución de ojos según glaucoma.") %>%
  kable_styling(bootstrap_options = "hover", full_width = F)
```

## Distribución por Sexo

```{r frecuencias-sexo}
gender.count <- df %>% 
  group_by(Glaucoma) %>% 
  count(Sexo) %>%
  pivot_wider(names_from = Glaucoma, values_from = n)
gender.count %>% 
  kable(caption = "Distribución según sexo y glaucoma.") %>% 
  kable_styling(bootstrap_options = "hover", full_width = F) %>%
  add_header_above(c(" " = 1, "Glaucoma" = 2))
```

## Distribución por Edad

```{r frecuencias-edad}
result <- df %>% 
  group_by(Glaucoma) %>% 
  summarise(Media = mean(Edad), "Desviación Típica" = sd(Edad), Mínimo = min(Edad), Máximo = max(Edad))
result %>% 
  kable(caption = "Estadísticos descriptivos de la edad según glaucoma.") %>% 
  kable_styling(bootstrap_options = "hover", full_width = F)
```

```{r distribucion-edad-glaucoma, fig.cap="Distribución de la edad según glaucoma."}
df %>%
  ggplot(aes(x = Edad, fill = Glaucoma)) + 
  geom_histogram(breaks = seq(0, 100, by = 10), alpha=0.8, col = "white") +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  ylab("Número de ojos")
```

```{r descriptiva-edad-genero-ojos, fig.cap="Distribución de sexo, ojo y edad según glaucoma."}
ggpairs(df, mapping=aes(color=Glaucoma, alpha=0.5), columns=c("Sexo", "Edad", "Ojo"))
```

# Glosario

- GCAA: Glaucoma de ángulo abierto
- OCT: Optical coherence tomography (Tomografía de coherencia óptica)
- BMO: Bruch Membrane Opening (Apertura de la membrana de Bruch)
- MRW: Minimum Rim Width (Grosor mínimo del anillo neuroretiniano)
- PRW: Perpendicular Rim Width (Grosor del anillo perpendicular)
- HRW: Horizontal Rim Width (Grosor del anillo horizontal)
- MRA: Minimum Rim Area within the neuroretinal tissue defined by the MRW (Area mínima del anillo neuroretiniano)
- PRA: Perpendicular Rim Area (Area del anillo perpendicular) 
- ONH: Optic Nerve Head (Cabeza del nervio óptico)
- RNFL: Retinal Nerve Fiber Layer (Capa de fibra nerviosa retiniana)
- INL: Inner Nuclear Layer (Capa nuclear interna de la retina)
- IPL: Inner Plexiform Layer (Capa plexiforme interna de la retina)
- ONL: Outer Plexiform Layer (Capa nuclear externa de la retina)
- OPL: Outer Plexiform Layer (Capa plexiforme externa de la retina)
- GCL: Ganglion Cell Layer (Capa de células ganglionares de la retina)
- RPE: Retinal Pigment Epithelium (Epitelio pigmentario de la retina)


